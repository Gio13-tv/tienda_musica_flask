<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Carrito de Compras</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            background: #f4f4f4;
            font-family: Arial, sans-serif;
        }

        .carrito-container {
            max-width: 1000px;
            margin: 50px auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .item {
            display: grid;
            grid-template-columns: 120px 1fr 100px 120px 60px;
            align-items: center;
            gap: 20px;
            border-bottom: 1px solid #ddd;
            padding: 20px 0;
        }

        .item img {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        }

        .item-name {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .item-price, .item-total {
            font-size: 1.1rem;
            color: #764ba2;
            font-weight: bold;
        }

        .qty-box {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .qty-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #764ba2;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
        }

        .qty-number {
            font-size: 1.1rem;
            font-weight: bold;
            width: 30px;
            text-align: center;
        }

        .remove-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #c0392b;
        }

        /* TOTAL FINAL */
        .total-container {
            text-align: right;
            margin-top: 25px;
        }

        .total-container h2 {
            font-size: 1.8rem;
            color: #333;
        }

        /* BOT√ìN COMPRAR */
        .buy-btn {
            background: #764ba2;
            padding: 15px 25px;
            color: white;
            font-size: 1.2rem;
            border: none;
            margin-top: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
        }

        .buy-btn:hover {
            background: #5a3d8e;
        }

        .empty {
            text-align: center;
            padding: 60px;
            color: #333;
            font-size: 1.3rem;
        }
    </style>
</head>
<body>

<div class="carrito-container">

    <h1>Carrito de Compras</h1>

    <div id="carrito-items"></div>

    <div id="carrito-vacio" class="empty" style="display:none;">
        Tu carrito est√° vac√≠o üòø<br><br>
        <a href="/productos" style="color:#764ba2;">Explorar productos</a>
    </div>

    <div class="total-container">
        <h2>Total: <span id="total-general">$0.00</span></h2>

        <form method="POST" action="/comprar">
            <button type="submit" class="buy-btn">Finalizar compra</button>
        </form>
    </div>

</div>

<script>
    // Cargar carrito desde backend 
    function cargarCarrito() {
        fetch("/ajax/obtener_carrito")
        .then(res => res.json())
        .then(data => {

            const cont = document.getElementById("carrito-items");
            cont.innerHTML = "";

            if (data.total_items === 0) {
                document.getElementById("carrito-vacio").style.display = "block";
                document.getElementById("total-general").innerText = "$0.00";
                return;
            }

            let html = "";
            data.carrito.forEach(item => {
                html += `
                <div class="item" data-id="${item.id}">
                    <img src="/static/images/${item.imagen}">

                    <div class="item-name">${item.nombre}</div>

                    <div class="item-price">$${item.precio.toFixed(2)}</div>

                    <div class="qty-box">
                        <button class="qty-btn" onclick="cambiarCantidad(${item.id}, -1)">-</button>
                        <span class="qty-number">${item.cantidad}</span>
                        <button class="qty-btn" onclick="cambiarCantidad(${item.id}, 1)">+</button>
                    </div>

                    <div class="item-total">$${(item.precio * item.cantidad).toFixed(2)}</div>

                    <button class="remove-btn" onclick="eliminar(${item.id})">üóëÔ∏è</button>
                </div>`;
            });

            cont.innerHTML = html;
            document.getElementById("total-general").innerText = "$" + data.total.toFixed(2);
        });
    }

    // Cambiar cantidad
    function cambiarCantidad(id, delta) {
        fetch("/ajax/obtener_carrito")
        .then(res => res.json())
        .then(data => {
            const item = data.carrito.find(i => i.id === id);
            if (!item) return;

            let nuevaCantidad = item.cantidad + delta;
            if (nuevaCantidad <= 0) {
                eliminar(id);
                return;
            }

            fetch("/ajax/agregar_carrito", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({producto_id: id, cantidad: delta})
            }).then(() => cargarCarrito());
        });
    }

    // Eliminar producto
    function eliminar(id) {
        fetch("/ajax/eliminar_carrito", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({producto_id: id})
        }).then(() => cargarCarrito());
    }

    cargarCarrito();
</script>

</body>
</html>
